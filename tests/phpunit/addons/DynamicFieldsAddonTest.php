<?php

class DynamicFieldsAddonTest extends WP_UnitTestCase
{
    protected $calledApi = 0;

    public function testAddons()
    {
        if (vcvenv('VCV_ENV_DEV_ADDONS')) {
            $path = vcapp()->path('devAddons/dynamicFields/dynamicFields');
            $this->assertTrue(is_dir($path), $path);
            wp_set_current_user(1);
            $this->loadAddon('dynamicFields');
            $this->assertFeaturedImage();
            $this->assertNesting();
            $this->assertNestedFeatured();
        }

        // Just to avoid empty warning
        $this->assertTrue(true);
    }

    protected function assertFeaturedImage()
    {
        $postId = $this->createPost('');
        $attachmentId = $this->createFeatured($postId);
        $url = wp_get_attachment_url($attachmentId);
        $featuredImageUrl = get_the_post_thumbnail_url();
        $this->assertNotEmpty($featuredImageUrl);
        $this->assertNotEmpty($url);
        $this->assertEquals($featuredImageUrl, $url);
        $featuredValue = vcfilter(
            'vcv:dynamic:value:featured_image',
            'testMe',
            [
                'atts' => [
                    'currentValue' => 'test',
                ],
            ]
        );

        $this->assertEquals($url . '?vcv-dynamic-field=featured_image&alt=&caption=&title=vcb-demo-imageMe', $featuredValue);
    }

    protected function assertNestedFeatured()
    {
        $postContent = '<!--vcv no format--><!--  vcwb/dynamicElementComment:5a1b36c9  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-1 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"xl","elementId":"5a1b36c9"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-2 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"lg","elementId":"5a1b36c9"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-3 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"md","elementId":"5a1b36c9"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-4 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"sm","elementId":"5a1b36c9"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-5 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"xs","elementId":"5a1b36c9"}  --><div class="vce-row-container"><div class="vce-row vce-element--xl--has-background vce-element--lg--has-background vce-element--md--has-background vce-element--sm--has-background vce-element--xs--has-background vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-5a1b36c9" data-vce-do-apply="all el-5a1b36c9"><div class="vce-content-background-container"><div class="vce-asset-background-simple-container vce-visible-xl-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-lg-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-md-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-sm-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-xs-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div></div><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-8a639733"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-8a639733"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-8a639733"><!-- vcwb/dynamicElementComment:e0474bfb --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"e0474bfb"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"e0474bfb"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"e0474bfb"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"e0474bfb"} --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-e0474bfb" data-vce-do-apply="all el-e0474bfb"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode :)</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">:)</div></div></div><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 --><!-- /vcwb/dynamicElementComment:e0474bfb --><div class="vce-text-block"><div class="vce-text-block-wrapper vce" id="el-4ccff310" data-vce-do-apply="all el-4ccff310"><h2>Typography is the art and technique</h2>
<p>Typography is the art and technique of arranging type to make written language legible, readable and appealing when displayed. The arrangement of type involves selecting typefaces, point size, line length, line-spacing (leading), letter-spacing (tracking), and adjusting the space within letters pairs (kerning).</p></div></div><!-- vcwb/dynamicElementComment:560fb495 --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"560fb495"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"560fb495"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"560fb495"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"560fb495"} --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-560fb495" data-vce-do-apply="all el-560fb495"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode :)</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">:)</div></div></div><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 --><!-- /vcwb/dynamicElementComment:560fb495 --></div></div></div></div></div></div><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-5  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-4  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-3  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-2  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-1  --><!--  /vcwb/dynamicElementComment:5a1b36c9  --><!--  vcwb/dynamicElementComment:656fbd48  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-1 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"xl","elementId":"656fbd48"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-2 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"lg","elementId":"656fbd48"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-3 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"md","elementId":"656fbd48"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-4 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"sm","elementId":"656fbd48"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-5 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"xs","elementId":"656fbd48"}  --><div class="vce-row-container"><div class="vce-row vce-element--xl--has-background vce-element--lg--has-background vce-element--md--has-background vce-element--sm--has-background vce-element--xs--has-background vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-656fbd48" data-vce-do-apply="all el-656fbd48"><div class="vce-content-background-container"><div class="vce-asset-background-simple-container vce-visible-xl-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-lg-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-md-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-sm-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-xs-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div></div><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-bc7dc7d5"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-bc7dc7d5"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-bc7dc7d5"><!-- vcwb/dynamicElementComment:7b02f6be --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"7b02f6be"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"7b02f6be"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"7b02f6be"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"7b02f6be"} --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-7b02f6be" data-vce-do-apply="all el-7b02f6be"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode :)</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">:)</div></div></div><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 --><!-- /vcwb/dynamicElementComment:7b02f6be --><div class="vce-text-block"><div class="vce-text-block-wrapper vce" id="el-9150f62e" data-vce-do-apply="all el-9150f62e"><h2>Typography is the art and technique</h2>
<p>Typography is the art and technique of arranging type to make written language legible, readable and appealing when displayed. The arrangement of type involves selecting typefaces, point size, line length, line-spacing (leading), letter-spacing (tracking), and adjusting the space within letters pairs (kerning).</p></div></div><!-- vcwb/dynamicElementComment:41f100ed --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"41f100ed"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"41f100ed"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"41f100ed"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"41f100ed"} --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-41f100ed" data-vce-do-apply="all el-41f100ed"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode :)</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">:)</div></div></div><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 --><!-- /vcwb/dynamicElementComment:41f100ed --></div></div></div></div></div></div><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-5  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-4  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-3  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-2  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-1  --><!--  /vcwb/dynamicElementComment:656fbd48  --><div class="vce-row-container"><div class="vce-row vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-e890cb05" data-vce-do-apply="all el-e890cb05"><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-61f31cfe"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-61f31cfe"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-61f31cfe"><div class="vce-text-block"><div class="vce-text-block-wrapper vce" id="el-b6372e81" data-vce-do-apply="all el-b6372e81"><h2>Typography is the art and technique</h2>
<p>Typography is the art and technique of arranging type to make written language legible, readable and appealing when displayed. The arrangement of type involves selecting typefaces, point size, line length, line-spacing (leading), letter-spacing (tracking), and adjusting the space within letters pairs (kerning).</p></div></div></div></div></div></div></div></div><!--  vcwb/dynamicElementComment:6822eed2  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-1 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"xl","elementId":"6822eed2"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-2 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"lg","elementId":"6822eed2"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-3 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"md","elementId":"6822eed2"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-4 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"sm","elementId":"6822eed2"}  --><!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-5 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","device":"xs","elementId":"6822eed2"}  --><div class="vce-row-container"><div class="vce-row vce-element--xl--has-background vce-element--lg--has-background vce-element--md--has-background vce-element--sm--has-background vce-element--xs--has-background vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-6822eed2" data-vce-do-apply="all el-6822eed2"><div class="vce-content-background-container"><div class="vce-asset-background-simple-container vce-visible-xl-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-lg-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-md-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-sm-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-xs-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div></div><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-43815e7a"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-43815e7a"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-43815e7a"><!-- vcwb/dynamicElementComment:39583ba9 --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"39583ba9"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"39583ba9"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"39583ba9"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"39583ba9"} --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-39583ba9" data-vce-do-apply="all el-39583ba9"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode :)</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">:)</div></div></div><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 --><!-- /vcwb/dynamicElementComment:39583ba9 --><div class="vce-text-block"><div class="vce-text-block-wrapper vce" id="el-88a23f15" data-vce-do-apply="all el-88a23f15"><h2>Typography is the art and technique</h2>
<p>Typography is the art and technique of arranging type to make written language legible, readable and appealing when displayed. The arrangement of type involves selecting typefaces, point size, line length, line-spacing (leading), letter-spacing (tracking), and adjusting the space within letters pairs (kerning).</p></div></div><!-- vcwb/dynamicElementComment:d1f9d0d5 --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"d1f9d0d5"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"d1f9d0d5"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"d1f9d0d5"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 {"value":"featured_image","currentValue":"-vcv--featured_image--vcv-","elementId":"d1f9d0d5"} --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-d1f9d0d5" data-vce-do-apply="all el-d1f9d0d5"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode :)</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">:)</div></div></div><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-4 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-3 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-2 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-2-1 --><!-- /vcwb/dynamicElementComment:d1f9d0d5 --></div></div></div></div></div></div><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-5  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-4  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-3  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-2  --><!--  /wp:vcv-gutenberg-blocks/dynamic-field-block-0-1  --><!--  /vcwb/dynamicElementComment:6822eed2  --><!--vcv no format-->';

        // Expected === PostContent - Comments + Parsed dynamic values

        $postContentExpected = '<!--  vcwb/dynamicElementComment:5a1b36c9  --><div class="vce-row-container"><div class="vce-row vce-element--xl--has-background vce-element--lg--has-background vce-element--md--has-background vce-element--sm--has-background vce-element--xs--has-background vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-5a1b36c9" data-vce-do-apply="all el-5a1b36c9"><div class="vce-content-background-container"><div class="vce-asset-background-simple-container vce-visible-xl-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-lg-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-md-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-sm-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-xs-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div></div><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-8a639733"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-8a639733"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-8a639733"><!-- vcwb/dynamicElementComment:e0474bfb --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-e0474bfb" data-vce-do-apply="all el-e0474bfb"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode 🙂</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">🙂</div></div></div><!-- /vcwb/dynamicElementComment:e0474bfb --><div class="vce-text-block"><div class="vce-text-block-wrapper vce" id="el-4ccff310" data-vce-do-apply="all el-4ccff310"><h2>Typography is the art and technique</h2>
<p>Typography is the art and technique of arranging type to make written language legible, readable and appealing when displayed. The arrangement of type involves selecting typefaces, point size, line length, line-spacing (leading), letter-spacing (tracking), and adjusting the space within letters pairs (kerning).</p></div></div><!-- vcwb/dynamicElementComment:560fb495 --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-560fb495" data-vce-do-apply="all el-560fb495"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode 🙂</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">🙂</div></div></div><!-- /vcwb/dynamicElementComment:560fb495 --></div></div></div></div></div></div><!--  /vcwb/dynamicElementComment:5a1b36c9  --><!--  vcwb/dynamicElementComment:656fbd48  --><div class="vce-row-container"><div class="vce-row vce-element--xl--has-background vce-element--lg--has-background vce-element--md--has-background vce-element--sm--has-background vce-element--xs--has-background vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-656fbd48" data-vce-do-apply="all el-656fbd48"><div class="vce-content-background-container"><div class="vce-asset-background-simple-container vce-visible-xl-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-lg-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-md-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-sm-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-xs-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div></div><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-bc7dc7d5"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-bc7dc7d5"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-bc7dc7d5"><!-- vcwb/dynamicElementComment:7b02f6be --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-7b02f6be" data-vce-do-apply="all el-7b02f6be"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode 🙂</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">🙂</div></div></div><!-- /vcwb/dynamicElementComment:7b02f6be --><div class="vce-text-block"><div class="vce-text-block-wrapper vce" id="el-9150f62e" data-vce-do-apply="all el-9150f62e"><h2>Typography is the art and technique</h2>
<p>Typography is the art and technique of arranging type to make written language legible, readable and appealing when displayed. The arrangement of type involves selecting typefaces, point size, line length, line-spacing (leading), letter-spacing (tracking), and adjusting the space within letters pairs (kerning).</p></div></div><!-- vcwb/dynamicElementComment:41f100ed --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-41f100ed" data-vce-do-apply="all el-41f100ed"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode 🙂</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">🙂</div></div></div><!-- /vcwb/dynamicElementComment:41f100ed --></div></div></div></div></div></div><!--  /vcwb/dynamicElementComment:656fbd48  --><div class="vce-row-container"><div class="vce-row vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-e890cb05" data-vce-do-apply="all el-e890cb05"><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-61f31cfe"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-61f31cfe"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-61f31cfe"><div class="vce-text-block"><div class="vce-text-block-wrapper vce" id="el-b6372e81" data-vce-do-apply="all el-b6372e81"><h2>Typography is the art and technique</h2>
<p>Typography is the art and technique of arranging type to make written language legible, readable and appealing when displayed. The arrangement of type involves selecting typefaces, point size, line length, line-spacing (leading), letter-spacing (tracking), and adjusting the space within letters pairs (kerning).</p></div></div></div></div></div></div></div></div><!--  vcwb/dynamicElementComment:6822eed2  --><div class="vce-row-container"><div class="vce-row vce-element--xl--has-background vce-element--lg--has-background vce-element--md--has-background vce-element--sm--has-background vce-element--xs--has-background vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-6822eed2" data-vce-do-apply="all el-6822eed2"><div class="vce-content-background-container"><div class="vce-asset-background-simple-container vce-visible-xl-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-lg-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-md-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-sm-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div><div class="vce-asset-background-simple-container vce-visible-xs-only vce-asset-background-simple--style-cover vce-asset-background-simple--position-center-top"><div class="vce-asset-background-simple"><div class="vce-asset-background-simple-item" style="background-image: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/elements/row/row/public/-vcv--featured_image--vcv-\');"></div></div></div></div><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-43815e7a"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-43815e7a"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-43815e7a"><!-- vcwb/dynamicElementComment:39583ba9 --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-39583ba9" data-vce-do-apply="all el-39583ba9"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode 🙂</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">🙂</div></div></div><!-- /vcwb/dynamicElementComment:39583ba9 --><div class="vce-text-block"><div class="vce-text-block-wrapper vce" id="el-88a23f15" data-vce-do-apply="all el-88a23f15"><h2>Typography is the art and technique</h2>
<p>Typography is the art and technique of arranging type to make written language legible, readable and appealing when displayed. The arrangement of type involves selecting typefaces, point size, line length, line-spacing (leading), letter-spacing (tracking), and adjusting the space within letters pairs (kerning).</p></div></div><!-- vcwb/dynamicElementComment:d1f9d0d5 --><div class="vce-single-image-container"><div class="vce vce-single-image-wrapper" id="el-d1f9d0d5" data-vce-do-apply="all el-d1f9d0d5"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><img src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" class="vce-single-image-inner"><p>The image below is made with shortcode 🙂</p><div class="vce-single-image-inner"><img class="vce-single-image" data-width="0" data-height="0" src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" data-img-src="http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-" alt="" title="vcb-demo-image" /></div><div style="background: url(\'http://127.0.0.1:8000/wp-content/plugins/visualcomposer/devElements/demoElement/demoElement/public/-vcv--featured_image--vcv-\'); width: 200px; height: 200px;">🙂</div></div></div><!-- /vcwb/dynamicElementComment:d1f9d0d5 --></div></div></div></div></div></div><!--  /vcwb/dynamicElementComment:6822eed2  -->';
        $postId = $this->createPost($postContent);
        $attachmentId = $this->createFeatured($postId);
        $url = wp_get_attachment_url($attachmentId);
        $featuredImageUrl = get_the_post_thumbnail_url();
        $post = get_post($postId);
        $actual = apply_filters('the_content', $post->post_content);

        $this->assertEquals(
            str_replace(
                '-vcv--featured_image--vcv-',
                $featuredImageUrl . '?vcv-dynamic-field=featured_image&alt=&caption=&title=vcb-demo-image',
                $postContentExpected
            ),
            $actual
        );
    }

    protected function loadAddon($addon)
    {
        $app = vcapp();
        $addonData = $app->path('devAddons/' . $addon . '/manifest.json');
        $devAddons = vc_create_module_mock('\VisualComposer\Modules\Development\DevAddons');
        $addonsMeta = $devAddons->call(
            'readManifests',
            [
                [$addonData],
            ]
        );
        $this->assertTrue(is_array($addonsMeta));
        $this->assertTrue(array_key_exists($addon, $addonsMeta));
        $addonsMeta[ $addon ]['tag'] = $addon;
        vcevent(
            'vcv:hub:addons:autoload',
            [
                $addonsMeta[ $addon ],
            ]
        );
    }

    protected function registerDynamicApi()
    {
        vchelper('Filters')->listen(
            'vcv:dynamic:value:testApi',
            function ($response, $payload) {
                $atts = $payload['atts'];
                if (isset($atts['currentValue'])) {
                    $this->calledApi++;
                    $response = str_replace($atts['currentValue'], 'replacedValue', $response);
                }

                return $response;
            }
        );
    }

    protected function createPost($content)
    {
        $postTypeHelper = vchelper('PostType');
        $postId = $postTypeHelper->create(
            [
                'post_type' => 'page',
                'post_content' => $content,
            ]
        );
        $this->assertTrue(is_numeric($postId));
        $this->assertTrue($postId > 0);
        $postTypeHelper->setupPost($postId);

        return $postId;
    }

    protected function assertNesting()
    {
        $this->registerDynamicApi();
        $postContent = '<!--  wp:vcv-gutenberg-blocks/dynamic-field-block-0-1 {"value":"testApi","currentValue":"toBeReplaced1"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-0-2 {"value":"testApi","currentValue":"toBeReplaced2"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-0-3 {"value":"testApi","currentValue":"toBeReplaced3"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-0-4 {"value":"testApi","currentValue":"toBeReplaced4"} --><!-- wp:vcv-gutenberg-blocks/dynamic-field-block-0-5 {"value":"testApi","currentValue":"toBeReplaced5"} --><div class="toBeReplaced1"><div class="test class1 toBeReplaced2" id="el-toBeReplaced3"><div class="vce-test" data-vcv-info="toBeReplaced4">toBeReplaced5</div></div></div><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-0-5 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-0-4 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-0-3 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-0-2 --><!-- /wp:vcv-gutenberg-blocks/dynamic-field-block-0-1 -->';
        $postId = $this->createPost($postContent);

        $post = get_post($postId);
        $actual = apply_filters('the_content', $post->post_content);
        $this->assertEquals(
            '<div class="replacedValue"><div class="test class1 replacedValue" id="el-replacedValue"><div class="vce-test" data-vcv-info="replacedValue">replacedValue</div></div></div>',
            $actual
        );
        //        $this->assertEquals(5, $this->calledApi);
    }

    protected function createFeatured($postId)
    {
        // Get the path to the upload directory.
        $uploadDir = wp_upload_dir();
        // $filename should be the path to a file in the upload directory .
        $filename = 'vcb-demo-image.jpg';
        $fullPath = $uploadDir['path'] . '/' . $filename;
        copy(__DIR__ . '/../../assets/' . $filename, $fullPath);
        chmod($fullPath, 0777);
        chmod($uploadDir['path'], 0777);
        // Check the type of file. We'll use this as the 'post_mime_type'.
        $fileType = wp_check_filetype(basename($filename), null);

        // Prepare an array of post data for the attachment.
        $attachment = [
            'guid' => $uploadDir['url'] . '/' . $postId . basename($filename),
            'post_mime_type' => $fileType['type'],
            'post_title' => preg_replace('/\.[^.]+$/', '', basename($filename)),
            'post_content' => '',
            'post_status' => 'inherit',
        ];
        // Attach the attachment to parent
        $attachmentId = wp_insert_attachment($attachment, $fullPath, $postId);
        $this->assertTrue(is_numeric($attachmentId));
        set_post_thumbnail($postId, $attachmentId);

        return $attachmentId;
    }
}
